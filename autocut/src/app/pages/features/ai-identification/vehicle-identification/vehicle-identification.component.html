<div class="min-h-screen bg-[#F5F5F5] flex flex-col items-center py-10">
  <div class="max-w-6xl w-full bg-white rounded-2xl shadow-md p-10 border border-gray-200">
    <h1 class="text-3xl font-bold text-[#1C1C1C] text-center mb-8">
      Identificaci칩n Autom치tica de Veh칤culos
    </h1>

    <p class="text-center text-gray-600 mb-14 max-w-3xl mx-auto text-lg leading-relaxed">
      Sube una foto de tu veh칤culo y deja que nuestra inteligencia artificial
      identifique la <strong class="text-[#880e0e]">marca</strong>,
      <strong class="text-[#880e0e]">modelo</strong>, <strong class="text-[#880e0e]">categor칤a</strong> y
      <strong class="text-[#880e0e]">a침o</strong> autom치ticamente.
    </p>


    <!-- Uploader Cloudinary -->
    <app-file-uploader [fileValidatorFn]="validateSingleImage"
      (filesSelected)="onFilesSelected($event)"></app-file-uploader>

    <div *ngIf="iaService.isAnalyzing$()" class="mt-10 text-center">
      <div class="animate-pulse text-gray-500">Analizando la imagen... 游댌</div>
    </div>

    <div *ngIf="!iaService.isAnalyzing$() && iaService.analysisResult$()" class="mt-10">
      <div class="flex flex-col items-center">
        <img [src]="imageURL" alt="Car Preview" class="w-120 h-56 object-cover rounded-lg shadow-md mb-6" />
      </div>

      <form #vehicleForm="ngForm" class="grid grid-cols-1 md:grid-cols-2 gap-6" (ngSubmit)="saveToCollection()"
        novalidate>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Marca</label>
          <select [(ngModel)]="vehicleData.marca" name="marca" required (ngModelChange)="onMarcaSeleccionada($event)"
            class="w-full border border-gray-300 rounded-md px-4 py-2 focus:ring-3 focus:ring-[#880e0e]/40 outline-none transition-all">
            <option [ngValue]="''" disabled>Seleccione una marca</option>
            <option *ngFor="let marca of marcas">{{ marca }}</option>
          </select>

          <div *ngIf="!vehicleData.marca" class="text-red-600 text-sm mt-1">
            Seleccione una marca.
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Modelo</label>
          <select [(ngModel)]="vehicleData.modelo" name="modelo" required [disabled]="!modelos.length"
            class="w-full border border-gray-300 rounded-md px-4 py-2 focus:ring-3 focus:ring-[#880e0e]/40 outline-none transition-all">
            <option [ngValue]="''" disabled>Seleccione un modelo</option>
            <option *ngFor="let modelo of modelos">{{ modelo }}</option>
          </select>
          <div *ngIf="!vehicleData.modelo" class="text-red-600 text-sm mt-1">
            Seleccione un modelo.
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Categor칤a</label>
          <select [(ngModel)]="vehicleData.categoria" name="categoria" required [disabled]="!categorias.length"
            class="w-full border capitalize border-gray-300 rounded-md px-4 py-2 focus:ring-3 focus:ring-[#880e0e]/40 outline-none transition-all">
            <option [ngValue]="''" disabled>Seleccione una categor칤a</option>
            <option *ngFor="let categoria of categorias">{{ categoria }}</option>
          </select>
          <div *ngIf="!vehicleData.categoria" class="text-red-600 text-sm mt-1">
            Seleccione una categor칤a.
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">A침o</label>
          <input [(ngModel)]="vehicleData.anio" name="anio" type="number" required min="1950" [max]="currentYear"
            class="w-full border border-gray-300 rounded-md px-4 py-2 focus:ring-3 focus:ring-[#880e0e]/40 outline-none transition-all"
            #anio="ngModel" />
          <div *ngIf="anio.invalid && anio.touched" class="text-red-600 text-sm mt-1">
            Ingrese un a침o v치lido (solo n칰meros, entre 1950 y {{ currentYear }}).
          </div>
        </div>

        <div class="col-span-2 flex justify-center mt-8">
          <button type="submit" [disabled]="vehicleForm.invalid"
            class="px-6 py-2 bg-[#880e0e] text-white rounded hover:bg-[#b71c1c] transition-all duration-200 disabled:opacity-60 disabled:cursor-not-allowed">
            Guardar en mi colecci칩n
          </button>
        </div>
      </form>
    </div>
  </div>
</div>