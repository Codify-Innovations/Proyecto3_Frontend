<div class="bg-[#F5F5F5] flex justify-center items-center px-16 py-5">
  <div
    class="flex w-full bg-white rounded-[1.5rem] shadow-[0_10px_40px_rgba(0,0,0,0.08)] border border-gray-200 overflow-hidden">
    <div
      class="w-[40%] flex flex-col justify-start items-center text-white px-10 py-14 relative overflow-y-visible rounded-l-[1.5rem] scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-transparent bg-gradient-to-b from-[#1C1C1C] to-[#424242] ">
      <div class="relative z-10">
        <h1 class="text-4xl font-bold tracking-tight mb-3">
          Detección de Vehículos
        </h1>
        <p class="text-gray-300 text-sm leading-relaxed max-w-sm mx-auto mb-10">
          Sube una imagen de tu vehículo y deja que nuestra IA detecte su
          <span class="text-[#8BC34A] font-medium ">marca</span>,
          <span class="text-[#8BC34A] font-medium ">modelo</span>,
          <span class="text-[#8BC34A] font-medium ">categoría</span> y
          <span class="text-[#8BC34A] font-medium ">año</span>.
        </p>

        <div>
          <app-file-uploader [fileValidatorFn]="validateSingleImage"
            (filesSelected)="onFilesSelected($event)"></app-file-uploader>
        </div>

      </div>
    </div>

    <div class="w-[60%] px-12 py-14 flex flex-col justify-center">
      <!-- Encabezado de sección -->
      <div class="flex items-center justify-between mb-8 border-b border-gray-200">
        <h2 class="text-3xl font-medium  text-[#1C1C1C]">
          Datos detectados por IA
        </h2>

        <button type="button" (click)="openPreview()"
          class="px-3 py-1.5 text-[13px] bg-[#a33b3b] mb-1 text-white font-medium rounded shadow-sm hover:bg-[#8c2f2f] transition-all disabled:opacity-50 disabled:cursor-not-allowed"
          [disabled]="!iaService.analysisResult$()">
          Ver imagen
        </button>
      </div>

      <!-- Indicador de análisis -->
      <div class="flex justify-center mb-6 h-[48px]">
        <div *ngIf="iaService.isAnalyzing$()"
          class="inline-flex items-center gap-3 bg-gray-100 border border-gray-300 px-6 py-3 rounded-full text-gray-700 shadow-sm animate-pulse">
          <span class="w-3 h-3 bg-[#8BC34A] rounded-full animate-ping"></span>
          <span class="font-medium">Analizando imagen...</span>
        </div>
      </div>


      <form #vehicleForm="ngForm" (ngSubmit)="saveToCollection()" class="grid grid-cols-2 gap-x-8 gap-y-6" novalidate>
        <!-- Marca -->
        <div>
          <label class="block text-sm font-medium  text-gray-700 mb-1">Marca</label>
          <input required [(ngModel)]="vehicleData.marca" name="marca" [disabled]="isFormDisabled"
            [ngClass]="{ 'opacity-60 cursor-not-allowed': isFormDisabled }"
            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-gray-800 bg-gray-50 focus:bg-white focus:ring-2 focus:ring-[#880e0e]/40 outline-none transition-all" />
        </div>

        <!-- Modelo -->
        <div>
          <label class="block text-sm font-medium  text-gray-700 mb-1">Modelo</label>
          <input required [(ngModel)]="vehicleData.modelo" name="modelo" [disabled]="isFormDisabled"
            [ngClass]="{ 'opacity-60 cursor-not-allowed': isFormDisabled }"
            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-gray-800 bg-gray-50 focus:bg-white focus:ring-2 focus:ring-[#880e0e]/40 outline-none transition-all" />
        </div>

        <!-- Categoría -->
        <div>
          <label class="block text-sm font-medium  text-gray-700 mb-1">Categoría</label>
          <select required [(ngModel)]="vehicleData.categoria" name="categoria" [disabled]="isFormDisabled"
            [ngClass]="{ 'opacity-60 cursor-not-allowed': isFormDisabled }"
            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 capitalize text-gray-800 bg-gray-50 focus:bg-white focus:ring-2 focus:ring-[#880e0e]/40 outline-none transition-all">
            <option [ngValue]="''" disabled>Seleccione una categoría</option>
            <option *ngFor="let cat of categories" [ngValue]="cat">
              {{ cat | titlecase }}
            </option>
          </select>
        </div>

        <!-- Color -->
        <div>
          <label class="block text-sm font-medium  text-gray-700 mb-1">Color</label>
          <select required [(ngModel)]="vehicleData.color" name="color" [disabled]="isFormDisabled"
            [ngClass]="{ 'opacity-60 cursor-not-allowed': isFormDisabled }"
            class="w-full border border-gray-300 rounded-lg px-4 py-2.5 capitalize text-gray-800 bg-gray-50 focus:bg-white focus:ring-2 focus:ring-[#880e0e]/40 outline-none transition-all">
            <option [ngValue]="''" disabled>Seleccione un color</option>
            <option *ngFor="let color of colors" [ngValue]="color">
              {{ color | translateColor }}
            </option>
          </select>
        </div>

        <!-- Año -->
        <div class="col-span-2 flex flex-col items-center mt-4">
          <label class="block text-sm font-medium  text-gray-700 mb-1 text-center mr-3">Año</label>
          <input [(ngModel)]="vehicleData.anio" name="anio" type="number" required min="1950" [max]="currentYear"
            [disabled]="isFormDisabled" [ngClass]="{ 'opacity-60 cursor-not-allowed': isFormDisabled }"
            class="w-1/3 border border-gray-300 rounded-lg px-4 py-2.5 text-center text-gray-800 bg-gray-50 focus:bg-white focus:ring-2 focus:ring-[#880e0e]/40 outline-none transition-all" />
        </div>

        <!-- Botón -->
        <div class="col-span-2 flex justify-center mt-10">
          <button type="submit" [disabled]="vehicleForm.invalid || isFormDisabled"
            class="px-10 py-3 bg-[#880e0e] text-white font-medium rounded shadow-[0_8px_20px_rgba(136,14,14,0.25)] hover:bg-[#B71C1C] transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
            Guardar en mi colección
          </button>
        </div>


      </form>
      <app-vehicle-preview-modal [imageURL]="imageURL" [isVisible]="showModal"
        (close)="closePreview()"></app-vehicle-preview-modal>
    </div>
  </div>
</div>